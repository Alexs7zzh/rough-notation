"use strict";const t="http://www.w3.org/2000/svg";function s(t,s,o,e,i){const n=()=>(2**31-1&(i.seed=Math.imul(48271,i.seed)))/2**31,h=(t,s=1)=>i.roughness*s*(n()*t*2-t),r=Math.pow(t-o,2)+Math.pow(s-e,2),c=Math.sqrt(r);let a=1;a=c<200?1:c>500?.4:-.0016668*c+1.233334;let u=i.maxRandomnessOffset||0;u*u*100>r&&(u=c/10);const f=.2+.2*n();let d=i.bowing*i.maxRandomnessOffset*(e-s)/200,l=i.bowing*i.maxRandomnessOffset*(t-o)/200;d=h(d,a),l=h(l,a);const w=[],m=()=>h(u,a);return w.push({op:"move",data:[t+h(u,a),s+h(u,a)]}),w.push({op:"bcurveTo",data:[d+t+(o-t)*f+m(),l+s+(e-s)*f+m(),d+t+2*(o-t)*f+m(),l+s+2*(e-s)*f+m(),o+m(),e+m()]}),w}function o(t,o,e,i,n){const h=[[t,o],[t+e,o],[t+e,o+i],[t,o+i]],r=h.length,c=[];for(let t=0;t<r-1;t++)c.push(...s(h[t][0],h[t][1],h[t+1][0],h[t+1][1],n));return c.push(...s(h[r-1][0],h[r-1][1],h[0][0],h[0][1],n)),c}function e(e,i,n,h,r,c,a){const u=[];let f=n.strokeWidth||2;const d=[5,5,5,5],l=void 0===n.animate||!!n.animate,w=function(t,s){return{maxRandomnessOffset:2,roughness:"underline"===t?2:1.5,bowing:1,strokeWidth:1.5,seed:s}}(h,a);switch(h){case"underline":{const t=i.y+i.h+d[2];u.push({type:"path",ops:s(i.x,t,i.x+i.w,t,w)});break}case"box":{const t=i.x-d[3],s=i.y-d[0],e=i.w+(d[1]+d[3]),n=i.h+(d[0]+d[2]);u.push({type:"path",ops:o(t,s,e,n,w)});break}}if(u.length){const s=function(t){const s=[];for(const o of t){let t="";for(const e of o.ops){const o=e.data;switch(e.op){case"move":t.trim()&&s.push(t.trim()),t=`M${o[0]} ${o[1]} `;break;case"bcurveTo":t+=`C${o[0]} ${o[1]}, ${o[2]} ${o[3]}, ${o[4]} ${o[5]} `}}t.trim()&&s.push(t.trim())}return s}(u),o=[],i=[];let n=0;const h=(t,s,o)=>t.setAttribute(s,o);for(const r of s){const s=document.createElementNS(t,"path");if(h(s,"d",r),h(s,"fill","none"),h(s,"stroke","currentColor"),h(s,"stroke-width",`${f}`),l){const t=s.getTotalLength();o.push(t),n+=t}e.appendChild(s),i.push(s)}if(l){let t=0;for(let s=0;s<i.length;s++){const e=i[s],h=o[s],a=n?c*(h/n):0,u=r+t,f=e.style;f.strokeDashoffset=`${h}`,f.strokeDasharray=`${h}`,f.animation=`rough-notation-dash ${a}ms ease-out ${u}ms forwards`,t+=a}}}}for(var i,n=256,h=[];n--;)h[n]=(n+256).toString(16).substring(1);class r{constructor(t,s){this.t="unattached",this.o=[],this.i=t,this.u=s,this.attach()}get className(){return this.u.className?this.u.className:"rough-annotation"}attach(){if("unattached"===this.t&&this.i.parentElement){!function(){if(!window.__rno_kf_s){const t=window.__rno_kf_s=document.createElement("style");t.textContent="@keyframes rough-notation-dash { to { stroke-dashoffset: 0; } }",document.head.appendChild(t)}}();const s=this.l=document.createElementNS(t,"svg");s.setAttribute("class",this.className),this.u.commentId&&(s.dataset.forComment=this.u.commentId);const o=s.style;if(o.position="absolute",o.top="0",o.left="0",o.overflow="visible",o.pointerEvents="none",o.width="100px",o.height="100px",this.u.rootId){const t=document.getElementById(this.u.rootId);t?t.appendChild(s):this.i.parentElement.appendChild(s)}else this.i.parentElement.appendChild(s);this.t="not-showing"}}show(){switch(this.t){case"unattached":break;case"showing":this.hide(),this.l&&this.render(this.l,!0);break;case"not-showing":this.attach(),this.l&&this.render(this.l,!1)}}remove(){this.l&&this.l.parentElement&&this.l.parentElement.removeChild(this.l)}refresh(){this.haveRectsChanged()&&this.show()}hide(){if(this.l)for(;this.l.lastChild;)this.l.removeChild(this.l.lastChild);this.t="not-showing"}haveRectsChanged(){if(this.o.length){const t=this.rects();if(t.length!==this.o.length)return!0;for(let s=0;s<t.length;s++)if(!this.isSameRect(t[s],this.o[s]))return!0}return!1}si(t,s){return Math.round(t)===Math.round(s)}isSameRect(t,s){return this.si(t.x,s.x)&&this.si(t.y,s.y)&&this.si(t.w,s.w)&&this.si(t.h,s.h)}render(t,s){let o=this.u;s&&(o.animate=!1);const i=this.rects();let n=0;i.forEach((t=>n+=t.w));const h=o.animationDuration||800;let r=0,c="underline";1===i.length&&n<140&&(c="box");for(let s=0;s<i.length;s++){const a=h*(i[s].w/n);e(t,i[s],o,c,r,a,Math.floor(Math.random()*2**31)),r+=a}this.o=i,this.t="showing"}rects(){const t=[];let s;if(this.l){const o=this.i.getClientRects();for(let e=0;e<o.length;e++){const i=o[e];void 0===s?s=i:this.si(i.left,s.right)&&this.si(i.top,s.top)?s.width+=i.width:(t.push(this.svgRect(s)),s=i)}t.push(this.svgRect(s))}return t}svgRect(t){const s=this.l.getBoundingClientRect(),o=t;return{x:(o.x||o.left)-(s.x||s.left),y:(o.y||o.top)-(s.y||s.top),w:o.width,h:o.height}}}class c{constructor(){this.m=new Map,this.g=new ResizeObserver(function(t,s=300){let o;return()=>{clearTimeout(o),o=setTimeout((()=>t()),s)}}((()=>{Array.from(this.m.values()).forEach((t=>t.refresh()))}))),this.g.observe(document.body)}add(t,s){const o=new r(t,s);o.show();const e=function(t){var s=0,o=t||11;if(!i||n+o>512)for(i="",n=0;s<256;s++)i+=h[256*Math.random()|0];return i.substring(n,n+++o)}(16);return this.m.set(e,o),e}remove(t){const s=this.m.get(t);s&&(s.remove(),this.m.delete(t))}}module.exports=function(){return new c};
