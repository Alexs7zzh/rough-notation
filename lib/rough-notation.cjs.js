"use strict";Object.defineProperty(exports,"t",{value:!0});const t="http://www.w3.org/2000/svg";function s(t,s,e,o,n){const i=()=>(2**31-1&(n.seed=Math.imul(48271,n.seed)))/2**31,h=(t,s=1)=>n.roughness*s*(i()*t*2-t),r=Math.pow(t-e,2)+Math.pow(s-o,2),c=Math.sqrt(r);let a=1;a=c<200?1:c>500?.4:-.0016668*c+1.233334;let u=n.maxRandomnessOffset||0;u*u*100>r&&(u=c/10);const f=.2+.2*i();let l=n.bowing*n.maxRandomnessOffset*(o-s)/200,d=n.bowing*n.maxRandomnessOffset*(t-e)/200;l=h(l,a),d=h(d,a);const w=[],m=()=>h(u,a);return w.push({op:"move",data:[t+h(u,a),s+h(u,a)]}),w.push({op:"bcurveTo",data:[l+t+(e-t)*f+m(),d+s+(o-s)*f+m(),l+t+2*(e-t)*f+m(),d+s+2*(o-s)*f+m(),e+m(),o+m()]}),w}function e(t,e,o,n,i){const h=[[t,e],[t+o,e],[t+o,e+n],[t,e+n]],r=h.length,c=[];for(let t=0;t<r-1;t++)c.push(...s(h[t][0],h[t][1],h[t+1][0],h[t+1][1],i));return c.push(...s(h[r-1][0],h[r-1][1],h[0][0],h[0][1],i)),c}function o(o,n,i,h,r,c){const a=[];let u=i.strokeWidth||2;const f=[5,5,5,5],l=void 0===i.animate||!!i.animate,d=function(t,s){return{maxRandomnessOffset:2,roughness:"underline"===t?2:1.5,bowing:1,strokeWidth:1.5,seed:s}}(i.type,c);switch(i.type){case"underline":{const t=n.y+n.h+f[2];a.push({type:"path",ops:s(n.x,t,n.x+n.w,t,d)});break}case"box":{const t=n.x-f[3],s=n.y-f[0],o=n.w+(f[1]+f[3]),i=n.h+(f[0]+f[2]);a.push({type:"path",ops:e(t,s,o,i,d)});break}}if(a.length){const s=function(t){const s=[];for(const e of t){let t="";for(const o of e.ops){const e=o.data;switch(o.op){case"move":t.trim()&&s.push(t.trim()),t=`M${e[0]} ${e[1]} `;break;case"bcurveTo":t+=`C${e[0]} ${e[1]}, ${e[2]} ${e[3]}, ${e[4]} ${e[5]} `}}t.trim()&&s.push(t.trim())}return s}(a),e=[],n=[];let i=0;const c=(t,s,e)=>t.setAttribute(s,e);for(const h of s){const s=document.createElementNS(t,"path");if(c(s,"d",h),c(s,"fill","none"),c(s,"stroke","currentColor"),c(s,"stroke-width",`${u}`),l){const t=s.getTotalLength();e.push(t),i+=t}o.appendChild(s),n.push(s)}if(l){let t=0;for(let s=0;s<n.length;s++){const o=n[s],c=e[s],a=i?r*(c/i):0,u=h+t,f=o.style;f.strokeDashoffset=`${c}`,f.strokeDasharray=`${c}`,f.animation=`rough-notation-dash ${a}ms ease-out ${u}ms forwards`,t+=a}}}}for(var n,i=256,h=[];i--;)h[i]=(i+256).toString(16).substring(1);class r{constructor(t,s){this.o="unattached",this.i=[],this.u=t,this.l=s,this.attach()}get className(){return this.l.className?this.l.className:"rough-annotation"}attach(){if("unattached"===this.o&&this.u.parentElement){!function(){if(!window.__rno_kf_s){const t=window.__rno_kf_s=document.createElement("style");t.textContent="@keyframes rough-notation-dash { to { stroke-dashoffset: 0; } }",document.head.appendChild(t)}}();const s=this.m=document.createElementNS(t,"svg");s.setAttribute("class",this.className),this.l.commentId&&(s.dataset.forComment=this.l.commentId);const e=s.style;if(e.position="absolute",e.top="0",e.left="0",e.overflow="visible",e.pointerEvents="none",e.width="100px",e.height="100px",this.l.rootId){const t=document.getElementById(this.l.rootId);t?t.appendChild(s):this.u.parentElement.appendChild(s)}else this.u.parentElement.appendChild(s);this.o="not-showing"}}show(){switch(this.o){case"unattached":break;case"showing":this.hide(),this.m&&this.render(this.m,!0);break;case"not-showing":this.attach(),this.m&&this.render(this.m,!1)}}remove(){this.m&&this.m.parentElement&&this.m.parentElement.removeChild(this.m)}refresh(){this.haveRectsChanged()&&this.show()}hide(){if(this.m)for(;this.m.lastChild;)this.m.removeChild(this.m.lastChild);this.o="not-showing"}haveRectsChanged(){if(this.i.length){const t=this.rects();if(t.length!==this.i.length)return!0;for(let s=0;s<t.length;s++)if(!this.isSameRect(t[s],this.i[s]))return!0}return!1}isSameRect(t,s){const e=(t,s)=>Math.round(t)===Math.round(s);return e(t.x,s.x)&&e(t.y,s.y)&&e(t.w,s.w)&&e(t.h,s.h)}render(t,s){let e=this.l;s&&(e.animate=!1);const n=this.rects();let i=0;n.forEach((t=>i+=t.w));const h=e.animationDuration||800;let r=0;for(let s=0;s<n.length;s++){const c=h*(n[s].w/i);o(t,n[s],e,r,c,Math.floor(Math.random()*2**31)),r+=c}this.i=n,this.o="showing"}rects(){const t=[];if(this.m){const s=this.u.getClientRects();for(let e=0;e<s.length;e++)t.push(this.svgRect(this.m,s[e]))}return t}svgRect(t,s){const e=t.getBoundingClientRect(),o=s;return{x:(o.x||o.left)-(e.x||e.left),y:(o.y||o.top)-(e.y||e.top),w:o.width,h:o.height}}}class c{constructor(){this.g=new Map,this.p=new ResizeObserver(function(t,s=300){let e;return()=>{clearTimeout(e),e=setTimeout((()=>t()),s)}}((()=>{Array.from(this.g.values()).forEach((t=>t.refresh()))}))),this.p.observe(document.body)}add(t,s){const e=new r(t,s);e.show();const o=function(t){var s=0,e=t||11;if(!n||i+e>512)for(n="",i=0;s<256;s++)n+=h[256*Math.random()|0];return n.substring(i,i+++e)}(16);return this.g.set(o,e),o}remove(t){const s=this.g.get(t);s&&(s.remove(),this.g.delete(t))}}function a(){return new c}exports.default=a,exports.main=a;
